$(document).ready(function(){function t(t){y=t}function a(){n=$(".js-open-right-category")}function s(t){var s=t.attr("data-category-id"),e=t.attr("data-service-id"),_=t.find(".gustavs__calc__service__subcategory__square").val(),o=t.attr("data-name"),l=v.clone(),n=y[s].service[e].subservice,u=0,d=0;l.find(".gustavs__calc__results__category__name").html(o),l.find(".gustavs__calc__results__category__square").val(_);for(var g in n){var h=n[g];l.find(".gustavs__calc__results__category__body").append('<div class="gustavs__calc__results__subcategory">'+h.name+'<div class="gustavs__calc__results__subcategory__price">'+h.price_for_one*_+" руб</div></div>"),u+=h.price_for_one*_,d+=h.day_to_do}t.attr("data-count-days",Math.round(d/60*_/24)),l.removeClass("js-template"),l.attr("data-count-days",Math.round(d/60*_/24)).attr("data-category-id",s).attr("data-service-id",e),l.find(".gustavs__calc__results__category__body").append('<div class="gustavs__calc__results__subcategory gustavs__calc__results__subcategory_sum">Сумма<div class="gustavs__calc__results__subcategory__price">'+u+" руб</div></div>"),l.appendTo(".js-right-service-body .overview").show(),$(".gustavs__calc__finish").html(c("plus",Math.round(d/60*_/24))),a(),i.customScrollbar("resize",!0),$(".js-work-price").html(r()+"Р")}function e(t){var a=t.attr("data-count-days"),s=t.attr("data-category-id"),e=t.attr("data-service-id"),_=$(".gustavs__calc__service__body").find(".gustavs__calc__service__subcategory[data-category-id="+s+"][data-service-id="+e+"]"),o=$(".gustavs__calc__results__body ").find(".gustavs__calc__results__category[data-category-id="+s+"][data-service-id="+e+"]");_.removeClass("can-remove").find(".js-add-service").html(g),o.remove(),i.customScrollbar("resize",!0),$(".gustavs__calc__finish").html(c("minus",a)),$(".js-work-price").html(r()+"Р")}function _(t,a){var s=a.attr("data-category-id"),e=a.attr("data-service-id"),_=y[s].service[e].subservice,c=0,o=0,i=$(".gustavs__calc__service__body").find(".gustavs__calc__service__subcategory[data-category-id="+s+"][data-service-id="+e+"]"),l=$(".gustavs__calc__results__body ").find(".gustavs__calc__results__category[data-category-id="+s+"][data-service-id="+e+"]");for(var n in _){var u=_[n];l.find(".gustavs__calc__results__subcategory__price").eq(n).html(u.price_for_one*t+" руб"),c+=u.price_for_one*t,o+=u.day_to_do}var d=Math.round(o/60*t/24),v=d-a.attr("data-count-days");m.setDate(m.getDate()+v),$(".gustavs__calc__finish").html(m.toLocaleString("ru",f)),l.attr("data-count-days",d),l.find(".gustavs__calc__results__category__square").val(t),i.attr("data-count-days",d),$(".gustavs__calc__results__subcategory_sum").find(".gustavs__calc__results__subcategory__price").html(c+"руб"),$(".js-work-price").html(r()+"Р")}function c(t,a){return"plus"===t?m.setDate(m.getDate()+a):m.setDate(m.getDate()-a),m.toLocaleString("ru",f)}function r(){var t=0;return $(".gustavs__calc__results__subcategory_sum").find(".gustavs__calc__results__subcategory__price").each(function(){var a=parseInt($(this).html());t+=a}),t}var o=$(".js-scrollable"),i=$(".js-right-scrollable"),l=$(".js-cat-open"),n=$(".js-open-right-category"),u=$(".js-add-service"),d=($(".js-right-service-body"),$(".js-service-subcat")),v=$(".js-template"),g="Добавить";o.customScrollbar(),i.customScrollbar();var y=[],h=new Date;h.setDate(h.getDate()+1);var m=new Date,f={year:"numeric",month:"long",day:"numeric"};$("#date").val(h.toLocaleString("ru",f)),$.ajax({url:"/redirect.php",success:function(a){console.log(JSON.parse(a)),t(JSON.parse(a,!0))}}),l.on("click",function(){$(this).parent().toggleClass("open");var t=setInterval(function(){o.customScrollbar("resize",!0)},50);setTimeout(function(){clearInterval(t)},400)}),$("body").on("click",".js-open-right-category",function(){$(this).parent().parent().toggleClass("open");var t=setInterval(function(){i.customScrollbar("resize",!0)},50);setTimeout(function(){clearInterval(t)},400)}),$("body").on("click",".js-right-category-remove",function(){e($(this).closest(".gustavs__calc__results__category"))}),$("#date").on("input",function(){console.log(123)}),$(".js-phone-validate").mask("+7(999) 999-99-99"),$("#date").datepicker({dayNames:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],firstDay:1,showOn:"focus",dateFormat:"dd MM, yy",altField:"#date",defaultDate:1,onSelect:function(t){var a=$("#date").datepicker("getDate");m=a}}),d.each(function(){$(this).attr("data-value",$(this).find(".gustavs__calc__service__subcategory__square").val()),$(this).attr("data-name",$(this).find(".gustavs__calc__service__subcategory__name").html())}),u.on("click",function(){$(this).closest(d).hasClass("can-remove")?($(this).html(g),$(this).closest(d).removeClass("can-remove"),e($(this).closest(d))):($(this).html("Удалить"),$(this).closest(d).addClass("can-remove"),s($(this).closest(d)))}),$(".gustavs__calc__service__subcategory__square").on("keyup",function(){$(this).parent().hasClass("can-remove")&&_($(this).val(),$(this).parent())}),$("body").on("keyup",".gustavs__calc__results__category__square",function(){_($(this).val(),$(this).parent().parent())})});